---
title: MyISAM与InnoDB性能测试对比
tags:
  - MySQL
categories:
  - MySQL
date: '2018-10-27 14:04'
abbrlink: 51443
---

MyISAM与InnoDB的优缺点在此就不再多说了，网上可以搜出一堆，而这种文章的最后一般都是推荐，读的多的使用MyISAM，写与更新多的推荐InnoDB，但是，了解过两种存储引擎之后，就会产生一种疑惑，InnoDB采用的是聚簇索引，无论是索引还是数据都是存放在内存中的，MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址，找到了之后还要到硬盘上去获取数据，这样肯定会造成时间损耗的，所以，还是准备用实验数据来解决疑惑

<!--more-->

我的MySQL的版本是 5.7.22， 服务器是1G1核

# 单进程写

> commit = 0 表示 my.cnf 中 **innodb_flush_log_at_trx_commit** 的属性值为0
>
> no index  表示除主键索引为无其他索引 这里有四个索引
>
> index 表示只有主键索引

| 数据（w） | MyISAM (index) | MyISAM  (no index) | InnoDB (commit=0) (index) | InnoDB (commit=0) (no index) |
| ----- | -------------- | ------------------ | ------------------------- | ---------------------------- |
| 1     | 6.39           | 3.90               | 4.99                      | 4.89                         |
| 5     | 26.89          | 22.73              | 29.80                     | 22.33                        |
| 10    | 49.55          | 34.96              | 53.40                     | 33.21                        |
| 50    | 189.20         | 139.93             | 260.78                    | 200.74                       |

综上可以看出，单进程一条一条的插入的时间，MyISAM的性能略占优势，但是并不太明显， 而无索引比有索引的又略占优势，这也是因为插入的时候同时还要注意维护索引树导致的，所以，索引虽好，可不要太贪了。



| 数据（w） | MyISAM (index) | MyISAM  (no index) | InnoDB (commit=0) (index) | InnoDB (commit=0) (no index) |
| ----- | -------------- | ------------------ | ------------------------- | ---------------------------- |
| 1     | 9.70           | 4.91               | 60.9                      | 49.8                         |
| 5     | 32.01          | 18.33              | 306.55                    | 243.17                       |

还有10w和50w的数据就不再比较了，因为性能差距太明显了，那这里就有一个问题了， **innodb_flush_log_at_trx_commit**  这个参数是什么意思，为什么会有那么大的影响

~~~
innodb_flush_log_at_trx_commit=0 （延迟写、实时刷）：log_buffer --每隔1秒--> log_file --实时--> disk
innodb_flush_log_at_trx_commit=1 （实时写、实时刷）：log_buffer --实时--> log_file --实时--> disk
innodb_flush_log_at_trx_commit=2 （实时写、延迟刷）：log_buffer --实时--> log_file --每隔1秒 --> disk
~~~

所以，这里其实是刷日志到硬盘导致的性能下降，这里还是需要注意的，性能影响还是很大的

# 多进程写

这里以每个进程写1w条数据为例

| 进程数  | MyISAM(s/进程) | InnoDB(s/进程) |
| ---- | ------------ | ------------ |
| 20   | 90.00        | 29.66        |
| 50   | 255.89       | 74.52        |
| 100  | 545.385      | 201.94       |

上面充分可以展示出来**InnoDB** 引擎在多进程下的优势

# 单进程读

| 总次数(w) | MyISAM(总时间 s) | InnoDB(总时间 s) |
| ------ | ------------- | ------------- |
| 1      | 67.14         | 77.15         |
| 5      | 110.58        | 104.21        |
| 10     | 136.02        | 146.26        |

# 多进程读

这里以每个进程读5k条数据为例

| 进程数  | MyISAM(s/进程) | InnoDB(s/进程) |
| ---- | ------------ | ------------ |
| 20   | 140.89       | 140.37       |
| 50   | 366.32       | 308.76       |
| 100  | 766.37       | 615.50       |

可以看出，在单进程的读中，MyISAM战友微弱的优势，但这种微弱的优势在多进程中也荡然无存了

再考虑**InnoDB** 支持 **事务**， **外键**， **崩溃恢复** 一系列高级特性，还有什么犹豫的吗？